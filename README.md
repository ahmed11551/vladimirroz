# Mini App для розыгрышей в Telegram

Telegram Mini App для проведения розыгрышей продуктов с оплатой через Сбербанк.

## Возможности

- **4 раздела**: Ассортимент, Отзывы, Доставка, Розыгрыши
- **Личный кабинет** — выигрыши и купленные номера
- **Розыгрыши** — выбор номеров, оплата, автоматический выбор победителя при заполнении таблицы
- **Оплата** — Сбербанк (СБП/карта). Номера записываются только после подтверждения оплаты
- **Без ограничений** — можно купить любое количество номеров
- **Админ/модератор** — управление контентом, розыгрышами, отзывами

## Запуск

```bash
# Установка зависимостей
npm install

# Запуск backend и frontend
npm run dev
```

- Frontend: http://localhost:5173
- Backend: http://localhost:3001

## Деплой фронта на Vercel

1. Залейте проект в GitHub (или подключите репозиторий в Vercel)
2. В Vercel: **Add New Project** → выберите репозиторий
3. **Root Directory**: укажите `frontend`
4. **Environment Variables**: добавьте `VITE_API_URL` = `https://ваш-backend.com/api` (URL вашего API)
5. Deploy

Фронт будет доступен по адресу вида `https://ваш-проект.vercel.app`

## Настройка Telegram Bot

1. Создайте бота через [@BotFather](https://t.me/BotFather)
2. В настройках бота укажите URL Mini App: `https://ваш-домен.com` (или ngrok для разработки)
3. Добавьте кнопку меню с `web_app` для открытия приложения

## Интеграция Сбербанк

Для реальных платежей:

1. Подключитесь к [Sber API](https://developers.sber.ru/) или [Платёжный шлюз](https://ecomtest.sberbank.ru/doc)
2. Укажите переменные:
   - `SBER_MERCHANT_ID` — ID мерчанта
   - `SBER_API_URL` — URL API
   - `BASE_URL` — ваш домен для webhook

3. Настройте webhook `/api/payments/webhook/sber` в личном кабинете Сбера

**Демо-режим**: без настроек Сбера используется симуляция оплаты для тестирования.

## Роли

- **user** — обычный пользователь
- **moderator** — модерация отзывов, просмотр
- **admin** — полный доступ, назначение ролей

Назначить роль: `PUT /api/admin/users/:id/role` с `{ "role": "admin" }` (только для admin).

**Первый админ**: отредактируйте `backend/data/db.json` — найдите своего пользователя (после первого входа в Mini App) и добавьте `"role": "admin"`.

## API

- `GET /api/raffles` — список розыгрышей
- `GET /api/raffles/:id` — детали + слоты
- `POST /api/payments/reserve` — резерв слотов, получить URL оплаты
- `GET /api/user/wins` — мои выигрыши
- `GET /api/user/slots` — мои номера
- `POST /api/user/reviews` — добавить отзыв
